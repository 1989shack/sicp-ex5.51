(%ex "2.11")

; exercise 2.11, page 95

(define (make-interval a b) (cons a b))

(define (upper-bound a)
  (let ((x (car a))
        (y (cdr a)))
    (if (> x y) x y)))

(define (lower-bound a)
  (let ((x (car a))
        (y (cdr a)))
    (if (< x y) x y)))

(define (mul-interval-ihateben x y)
  (define neg -1)
  (define span 0)
  (define pos 1)
  (define (type int)
    (cond
      ((> 0 (upper-bound int)) neg)
      ((> 0 (lower-bound int)) span)
      (else pos)))
  (define x-type (type x))
  (define y-type (type y))
  (define (xy-have-type type1 type2)
    (and (= x-type type1) (= y-type type2)))
  (define lx (lower-bound x))
  (define ux (upper-bound x))
  (define ly (lower-bound y))
  (define uy (upper-bound y))
  (define (make l1 l2 u1 u2)
    (make-interval (* l1 l2) (* u1 u2)))
  (cond
    ((xy-have-type pos pos) (make lx ly ux uy))
    ((xy-have-type pos span) (make ux ly ux uy))
    ((xy-have-type pos neg) (make ux ly lx uy))
    ((xy-have-type neg pos) (make lx uy ux ly))
    ((xy-have-type neg neg) (make ux uy lx ly))
    ((xy-have-type neg span) (make lx uy lx ly))
    ((xy-have-type span pos) (make lx uy ux uy))
    ((xy-have-type span neg) (make ux ly lx ly))
    ((xy-have-type span span)
     (make-interval (min (* lx uy) (* ux ly)) (max (* lx ly) (* ux uy))))
    (else error "didn't expect to be here")))

(let ((pos (make-interval 9 11))
      (neg (make-interval -21 -19))
      (span (make-interval -0.5 1.5)))
  (display "pos = ") (display pos) (newline)
  (display "span = ") (display span) (newline)
  (display "neg = ") (display neg) (newline)
  (newline)
  (display "pos x pos:  ") (display (mul-interval-ihateben pos pos))
  (newline)
  (display "pos x neg:  ") (display (mul-interval-ihateben pos neg))
  (newline)
  (display "pos x span:  ") (display (mul-interval-ihateben pos span))
  (newline)
  (display "neg x pos:  ") (display (mul-interval-ihateben neg pos))
  (newline)
  (display "neg x neg:  ") (display (mul-interval-ihateben neg neg))
  (newline)
  (display "neg x span:  ") (display (mul-interval-ihateben neg span))
  (newline)
  (display "span x pos:  ") (display (mul-interval-ihateben span pos))
  (newline)
  (display "span x neg:  ") (display (mul-interval-ihateben span neg))
  (newline)
  (display "span x span:  ") (display (mul-interval-ihateben span span)))
